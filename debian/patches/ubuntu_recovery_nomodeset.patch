Description: Set nomodeset for recovery mode
 Also disable 'set gfxpayload=keep' even if the system normally supports it.
 .
 https://launchpad.net/ubuntu/+spec/desktop-o-xorg-tools-and-processes
Author: Colin Watson <cjwatson@ubuntu.com>
Forwarded: no
Last-Update: 2011-05-23

Index: b/util/grub.d/10_linux.in
===================================================================
--- a/util/grub.d/10_linux.in
+++ b/util/grub.d/10_linux.in
@@ -93,11 +93,11 @@
 EOF
   if ! ${recovery} ; then
       save_default_entry | sed -e "s/^/\t/"
-  fi
 
-  cat << EOF
+      cat << EOF
 	gfxmode \$linux_gfx_mode
 EOF
+  fi
 
   cat << EOF
 	insmod gzio
@@ -244,7 +244,7 @@
       quiet
   if [ "x${GRUB_DISABLE_RECOVERY}" != "xtrue" ]; then
     linux_entry "${OS}" "${version}" true \
-	"single ${GRUB_CMDLINE_LINUX}"
+	"single nomodeset ${GRUB_CMDLINE_LINUX}"
   fi
 
   list=`echo $list | tr ' ' '\n' | grep -vx $linux | tr '\n' ' '`
